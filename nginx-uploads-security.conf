# Nginx Security Configuration for Uploads Directory

# Add this configuration to your nginx site configuration
# Location: /etc/nginx/sites-available/your-site.conf

# Disable script execution in uploads directory
location ~* ^/uploads/.*\.(php|php3|php4|php5|phtml|pl|py|jsp|asp|sh|cgi|exe)$ {
    deny all;
    return 403;
}

# Serve only images from uploads directory
location /uploads/ {
    # Only allow specific image MIME types
    types {
        image/jpeg jpg jpeg;
        image/png png;
        image/gif gif;
        image/webp webp;
        image/svg+xml svg;
    }
    
    # Default to binary if type not matched
    default_type application/octet-stream;
    
    # Security headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header X-XSS-Protection "1; mode=block";
    
    # Disable directory listing
    autoindex off;
    
    # Cache images for better performance
    expires 30d;
    add_header Cache-Control "public, immutable";
}

# Additional security headers for the entire site
add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Disable server signature
server_tokens off;
