generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                  String                    @id @default(cuid())
  username            String                    @unique
  password            String
  name                String
  email               String?                   @unique
  emailVerified       DateTime?
  role                String
  roles               Json                      @default("[]")
  avatarUrl           String?
  isApproved          Boolean                   @default(false)
  approvedAt          DateTime?
  approvedBy          String?
  passwordChangedAt   DateTime?
  failedLoginAttempts Int                       @default(0)
  lockedUntil         DateTime?
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt
  financialAccess     FinancialCategoryAccess[]
  santriProfile       Santri?
  permissions         UserPermission[]
  ustadzProfile       UstadzProfile?
  bookkeepingAssignments BookkeepingAssignment[]
  accounts            Account[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([provider, providerAccountId])
}

model Role {
  id          String           @id @default(cuid())
  name        String           @unique
  permissions RolePermission[]
}

model Permission {
  id              String           @id @default(cuid())
  action          String
  resource        String
  rolePermissions RolePermission[]
  userPermissions UserPermission[]
}

model RolePermission {
  id           String     @id @default(cuid())
  roleId       String
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id])
  role         Role       @relation(fields: [roleId], references: [id])

  @@unique([roleId, permissionId])
}

model UserPermission {
  id           String     @id @default(cuid())
  userId       String
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id])
  user         User       @relation(fields: [userId], references: [id])

  @@unique([userId, permissionId])
}

model AppSettings {
  id        String   @id @default(cuid())
  appName   String   @default("Sistem Pondok")
  logoUrl   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PondokProfile {
  id          String   @id @default(cuid())
  name        String
  address     String?
  phone       String?
  email       String?
  website     String?
  logoUrl     String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PDFLayoutSettings {
  id             String   @id @default(cuid())
  lembagaId      String?  @unique
  showLogo       Boolean  @default(true)
  logoUrl        String?
  logoSize       Int      @default(30)
  headerText     String?
  schoolName     String?
  address        String?
  phone          String?
  email          String?
  website        String?
  showPondokName Boolean  @default(true)
  pondokNameSize Int      @default(14)
  footerText     String?
  content        String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  lembaga        Lembaga? @relation(fields: [lembagaId], references: [id])
}

model SyncMetadata {
  id           String   @id @default(cuid())
  dataType     String   @unique
  lastModified DateTime @default(now())
  recordCount  Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Lembaga {
  id                String                 @id @default(cuid())
  name              String
  address           String?
  phone             String?
  email             String?
  logoUrl           String?
  jenjang           String?
  tags              String?
  
  // Mudir (Kepala Lembaga)
  mudirId           String?
  mudir             UstadzProfile?         @relation("LembagaMudir", fields: [mudirId], references: [id])
  
  academicCalendars AcademicCalendar[]
  academicYears     AcademicYear[]
  eventLembagas     EventLembaga[]
  gradeSettings     GradeSetting[]
  gradeWeights      GradeWeight[]
  jamPelajaran      JamPelajaran[]
  kelas             Kelas[]
  gradeCategories   LembagaGradeCategory[]
  mapelGroups       MapelGroup[]
  nilais            Nilai[]
  pdfLayoutSettings PDFLayoutSettings?
  santris           Santri[]
  documents         DocumentArchive[]
  bookkeepings      Bookkeeping[]
}

model LembagaGradeCategory {
  id        String   @id @default(cuid())
  lembagaId String
  name      String
  groupName String?
  gradeType String   @default("LETTER")
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lembaga   Lembaga  @relation(fields: [lembagaId], references: [id], onDelete: Cascade)
  nilais    Nilai[]

  @@unique([lembagaId, name])
  @@index([lembagaId])
}

model Santri {
  id              String              @id @default(cuid())
  nis             String              @unique
  nisn            String?
  nama            String
  gender          String
  birthPlace      String?
  birthDate       DateTime?
  address         String?
  phone           String?
  email           String?
  bpjsNumber      String?
  kkNumber        String?
  nikNumber       String?
  previousSchool  String?
  entryDate       DateTime?           @default(now())
  status          String              @default("ACTIVE")
  fatherName      String?
  fatherNik       String?
  fatherPhone     String?
  fatherJob       String?
  fatherIncome    String?
  motherName      String?
  motherNik       String?
  motherPhone     String?
  motherJob       String?
  motherIncome    String?
  waliName        String?
  waliNik         String?
  waliPhone       String?
  waliJob         String?
  waliRelation    String?
  waliPassword    String?
  lembagaId       String
  kelasId         String?
  asramaId        String?
  halqohId        String?
  userId          String?             @unique
  achievements    AchievementRecord[]
  ketuaAsramaOf   Asrama?             @relation("AsramaKetuaAsrama")
  billings        Billing[]
  ibadahRecords   IbadahRecord[]
  classAsLeader   Kelas?              @relation("ClassLeader")
  kelasHistory    KelasHistory[]
  nilais          Nilai[]
  piketSchedules  PiketSchedule[]
  asrama          Asrama?             @relation("AsramaSantris", fields: [asramaId], references: [id])
  halqoh          Halqoh?             @relation(fields: [halqohId], references: [id])
  kelas           Kelas?              @relation(fields: [kelasId], references: [id])
  lembaga         Lembaga             @relation(fields: [lembagaId], references: [id])
  user            User?               @relation(fields: [userId], references: [id])
  tagihans        Tagihan[]
  tahfidzRecords  Tahfidz[]
  violations      ViolationRecord[]
}

model Kelas {
  id             String            @id @default(cuid())
  name           String
  level          String
  lembagaId      String
  ketuaKelasId   String?           @unique
  waliKelasId    String?
  nextKelasId    String?
  jadwals        JadwalPelajaran[]
  ketuaKelas     Santri?           @relation("ClassLeader", fields: [ketuaKelasId], references: [id])
  lembaga        Lembaga           @relation(fields: [lembagaId], references: [id])
  nextKelas      Kelas?            @relation("ClassPromotion", fields: [nextKelasId], references: [id])
  prevKelas      Kelas[]           @relation("ClassPromotion")
  waliKelas      UstadzProfile?    @relation("HomeroomTeacher", fields: [waliKelasId], references: [id])
  kelasHistory   KelasHistory[]
  mapels           Mapel[]
  piketSchedules   PiketSchedule[]
  santris          Santri[]
}

model JamPelajaran {
  id        String            @id @default(cuid())
  lembagaId String
  name      String
  startTime String
  endTime   String
  order     Int
  jadwals   JadwalPelajaran[]
  lembaga   Lembaga           @relation(fields: [lembagaId], references: [id])
}

model JadwalPelajaran {
  id             String       @id @default(cuid())
  day            String
  kelasId        String
  mapelId        String?
  jamPelajaranId String
  jamPelajaran   JamPelajaran @relation(fields: [jamPelajaranId], references: [id])
  kelas          Kelas        @relation(fields: [kelasId], references: [id])
  mapel          Mapel?       @relation(fields: [mapelId], references: [id])
}

model Asrama {
  id             String          @id @default(cuid())
  name           String
  capacity       Int
  gender         String?
  address        String?
  ketuaAsramaId  String?         @unique
  musyrifId      String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  ketuaAsrama    Santri?         @relation("AsramaKetuaAsrama", fields: [ketuaAsramaId], references: [id])
  musyrif        UstadzProfile?  @relation(fields: [musyrifId], references: [id])
  piketSchedules PiketSchedule[]
  santris        Santri[]        @relation("AsramaSantris")
}

model Halqoh {
  id          String         @id @default(cuid())
  name        String
  description String?
  ustadzId    String?
  schedule    String?
  level       String?
  maxCapacity Int?
  status      String         @default("ACTIVE")
  ustadz      UstadzProfile? @relation(fields: [ustadzId], references: [id])
  santris     Santri[]
}

model UstadzProfile {
  id              String    @id @default(cuid())
  userId          String?   @unique
  nik             String?   @unique
  phone           String?
  address         String?
  birthPlace      String?
  birthDate       DateTime?
  hireDate        DateTime? @default(now())
  status          String    @default("ACTIVE")
  specialization  String?
  education       String?
  asramaMusyrif   Asrama[]
  halqohs         Halqoh[]
  homeroomClasses Kelas[]   @relation("HomeroomTeacher")
  lembagaAsMudir  Lembaga[] @relation("LembagaMudir")
  mapels          Mapel[]
  tahfidzRecords  Tahfidz[]
  user            User?     @relation(fields: [userId], references: [id])
}

model AcademicYear {
  id             String    @id @default(cuid())
  name           String
  startDate      DateTime
  endDate        DateTime
  isActive       Boolean   @default(false)
  lembagaId      String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  lembaga        Lembaga?  @relation(fields: [lembagaId], references: [id])
  nilais         Nilai[]
  tahfidzRecords Tahfidz[]
  ujians         Ujian[]
}

model AcademicCalendar {
  id            String         @id @default(cuid())
  title         String
  startDate     DateTime
  endDate       DateTime
  description   String?
  type          String
  academicYear  String?
  color         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  lembagaId     String?
  lembaga       Lembaga?       @relation(fields: [lembagaId], references: [id])
  eventLembagas EventLembaga[]
}

model EventLembaga {
  id        String           @id @default(cuid())
  eventId   String
  lembagaId String
  event     AcademicCalendar @relation(fields: [eventId], references: [id], onDelete: Cascade)
  lembaga   Lembaga          @relation(fields: [lembagaId], references: [id], onDelete: Cascade)

  @@unique([eventId, lembagaId])
}

model MapelGroup {
  id        String   @id @default(cuid())
  lembagaId String
  name      String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  mapels    Mapel[]
  lembaga   Lembaga  @relation(fields: [lembagaId], references: [id], onDelete: Cascade)

  @@unique([lembagaId, name])
  @@index([lembagaId])
}

model Mapel {
  id                 String             @id @default(cuid())
  name               String
  code               String?
  kelasId            String
  ustadzId           String?
  groupId            String?
  jadwals            JadwalPelajaran[]
  group              MapelGroup?        @relation(fields: [groupId], references: [id])
  kelas              Kelas              @relation(fields: [kelasId], references: [id])
  ustadz             UstadzProfile?     @relation(fields: [ustadzId], references: [id])
  nilais             Nilai[]
  questionBank       QuestionBank[]
  questionCategories QuestionCategory[]
  ujians             Ujian[]
}

model Ujian {
  id             String         @id @default(cuid())
  name           String
  type           String
  date           DateTime
  duration       Int?
  description    String?
  semester       String?
  academicYearId String?
  mapelId        String
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  questions      ExamQuestion[]
  nilais         Nilai[]
  academicYear   AcademicYear?  @relation(fields: [academicYearId], references: [id])
  mapel          Mapel          @relation(fields: [mapelId], references: [id])
}

model Nilai {
  id             String                @id @default(cuid())
  gradeType      String                @default("NUMERIC")
  score          Float?
  letterGrade    String?
  category       String                @default("UJIAN")
  semester       String?
  academicYearId String?
  santriId       String
  mapelId        String?
  ujianId        String?
  lembagaId      String?
  categoryId     String?
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
  academicYear   AcademicYear?         @relation(fields: [academicYearId], references: [id])
  gradeCategory  LembagaGradeCategory? @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  lembaga        Lembaga?              @relation(fields: [lembagaId], references: [id])
  mapel          Mapel?                @relation(fields: [mapelId], references: [id])
  santri         Santri                @relation(fields: [santriId], references: [id])
  ujian          Ujian?                @relation(fields: [ujianId], references: [id])
}

model GradeWeight {
  id        String   @id @default(cuid())
  lembagaId String
  examType  String
  weight    Float    @default(1.0)
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lembaga   Lembaga  @relation(fields: [lembagaId], references: [id], onDelete: Cascade)

  @@unique([lembagaId, examType])
  @@index([lembagaId])
}

model QuestionCategory {
  id          String         @id @default(cuid())
  name        String
  description String?
  mapelId     String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  questions   QuestionBank[]
  mapel       Mapel          @relation(fields: [mapelId], references: [id])
}

model QuestionBank {
  id            String            @id @default(cuid())
  question      String
  type          String
  difficulty    String            @default("MEDIUM")
  points        Int               @default(1)
  explanation   String?
  imageUrl      String?
  mapelId       String
  categoryId    String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  examQuestions ExamQuestion[]
  category      QuestionCategory? @relation(fields: [categoryId], references: [id])
  mapel         Mapel             @relation(fields: [mapelId], references: [id])
  options       QuestionOption[]
}

model QuestionOption {
  id         String       @id @default(cuid())
  questionId String
  optionText String
  isCorrect  Boolean      @default(false)
  order      Int
  question   QuestionBank @relation(fields: [questionId], references: [id], onDelete: Cascade)
}

model ExamQuestion {
  id             String        @id @default(cuid())
  ujianId        String
  questionBankId String?
  directQuestion String?
  directType     String?
  directOptions  String?
  directAnswer   String?
  imageUrl       String?
  order          Int
  points         Int           @default(1)
  itemType       String        @default("QUESTION")
  questionBank   QuestionBank? @relation(fields: [questionBankId], references: [id])
  ujian          Ujian         @relation(fields: [ujianId], references: [id], onDelete: Cascade)
}

model Tahfidz {
  id             String         @id @default(cuid())
  santriId       String
  ustadzId       String?
  date           DateTime       @default(now())
  surah          String
  ayatStart      Int
  ayatEnd        Int
  type           String
  grade          String?
  note           String?
  semester       String?
  academicYearId String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @default(now()) @updatedAt
  academicYear   AcademicYear?  @relation(fields: [academicYearId], references: [id])
  santri         Santri         @relation(fields: [santriId], references: [id])
  ustadz         UstadzProfile? @relation(fields: [ustadzId], references: [id])
}

model BillingCategory {
  id          String    @id @default(cuid())
  name        String
  description String?
  isRecurring Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  billings    Billing[]
}

model Billing {
  id           String          @id @default(cuid())
  santriId     String
  categoryId   String
  amount       Float
  dueDate      DateTime
  status       String          @default("UNPAID")
  description  String?
  academicYear String?
  month        String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  category     BillingCategory @relation(fields: [categoryId], references: [id])
  santri       Santri          @relation(fields: [santriId], references: [id])
  payments     Payment[]
}

model Payment {
  id            String   @id @default(cuid())
  billingId     String
  amount        Float
  paymentDate   DateTime @default(now())
  paymentMethod String
  receiptNumber String   @unique
  note          String?
  recordedBy    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  billing       Billing  @relation(fields: [billingId], references: [id])
}

model TransactionCategory {
  id           String        @id @default(cuid())
  name         String
  type         String
  description  String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  transactions Transaction[]
}

model Transaction {
  id            String              @id @default(cuid())
  categoryId    String
  bookkeepingId String?             // Link to bookkeeping (optional for backward compatibility)
  amount        Float
  type          String
  date          DateTime            @default(now())
  description   String
  reference     String?
  recordedBy    String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  category      TransactionCategory @relation(fields: [categoryId], references: [id])
  bookkeeping   Bookkeeping?        @relation(fields: [bookkeepingId], references: [id])
  
  @@index([bookkeepingId])
  @@index([date])
}

model KelasHistory {
  id           String    @id @default(cuid())
  santriId     String
  kelasId      String
  startDate    DateTime  @default(now())
  endDate      DateTime?
  academicYear String
  semester     String?
  status       String
  kelas        Kelas     @relation(fields: [kelasId], references: [id])
  santri       Santri    @relation(fields: [santriId], references: [id])
}

model ViolationCategory {
  id          String            @id @default(cuid())
  name        String
  type        String
  points      Int
  description String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  records     ViolationRecord[]
}

model ViolationRecord {
  id          String            @id @default(cuid())
  santriId    String
  categoryId  String
  date        DateTime
  description String?
  sanction    String?
  status      String
  reportedBy  String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  category    ViolationCategory @relation(fields: [categoryId], references: [id])
  santri      Santri            @relation(fields: [santriId], references: [id])
}

model AchievementRecord {
  id          String   @id @default(cuid())
  santriId    String
  title       String
  category    String
  level       String
  rank        String?
  date        DateTime
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  santri      Santri   @relation(fields: [santriId], references: [id])
}

model IbadahRecord {
  id        String   @id @default(cuid())
  santriId  String
  date      DateTime
  prayer    String
  status    String
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  santri    Santri   @relation(fields: [santriId], references: [id])

  @@unique([santriId, date, prayer])
}

model PiketSchedule {
  id          String     @id @default(cuid())
  type        String
  asramaId    String?
  kelasId     String?
  day         String
  santriId    String
  area        String?
  role        String?
  piketAreaId String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  asrama      Asrama?    @relation(fields: [asramaId], references: [id])
  kelas       Kelas?     @relation(fields: [kelasId], references: [id])
  piketArea   PiketArea? @relation(fields: [piketAreaId], references: [id])
  santri      Santri     @relation(fields: [santriId], references: [id])
}

model PiketArea {
  id          String          @id @default(cuid())
  name        String
  frequency   String
  description String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  schedules   PiketSchedule[]
}

model DailySchedule {
  id          String   @id @default(cuid())
  name        String
  type        String
  startTime   String
  endTime     String
  days        String
  location    String?
  description String?
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Keuangan {
  id          String   @id @default(cuid())
  date        DateTime @default(now())
  type        String
  amount      Float
  category    String
  description String?
  proofUrl    String?
  division    String?
}

model Tagihan {
  id       String    @id @default(cuid())
  santriId String
  title    String
  amount   Float
  dueDate  DateTime
  status   String
  paidDate DateTime?
  santri   Santri    @relation(fields: [santriId], references: [id])
}

model FinancialCategoryAccess {
  id       String @id @default(cuid())
  userId   String
  category String
  user     User   @relation(fields: [userId], references: [id])
}

model Asset {
  id              String           @id @default(cuid())
  name            String
  code            String?          @unique
  category        String
  condition       String
  location        String?
  purchaseDate    DateTime?
  price           Float?
  maintenanceLogs MaintenanceLog[]
}

model MaintenanceLog {
  id          String   @id @default(cuid())
  assetId     String
  date        DateTime @default(now())
  description String
  cost        Float?
  performer   String?
  asset       Asset    @relation(fields: [assetId], references: [id])
}


model DocumentArchive {
  id          String   @id @default(cuid())
  title       String
  type        String   // Jenis surat (lihat DOCUMENT_TYPES)
  number      String?  // Auto-generated
  date        DateTime
  sender      String?
  recipient   String?
  fileUrl     String
  description String?
  
  // Lembaga (optional - null jika surat umum pondok)
  lembagaId   String?
  lembaga     Lembaga? @relation(fields: [lembagaId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([lembagaId])
  @@index([type])
  @@index([date])
}

model RadioSchedule {
  id        String   @id @default(cuid())
  title     String
  startTime DateTime
  endTime   DateTime
  host      String?
  topic     String?
  streamUrl String?
}

model AgendaKantor {
  id          String   @id @default(cuid())
  title       String
  description String?
  date        DateTime
  startTime   String?  // "09:00"
  endTime     String?  // "11:00"
  location    String?
  type        String   // "RAPAT", "ACARA", "DEADLINE", "LAINNYA"
  status      String   @default("PLANNED") // "PLANNED", "ONGOING", "COMPLETED", "CANCELLED"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Bookkeeping System - Multi-level (Umum/Lembaga/Custom)
model Bookkeeping {
  id            String                  @id @default(cuid())
  name          String                  // e.g., "Pembukuan Umum", "Pembukuan Lembaga A", "Kas Masjid"
  type          String                  // "UMUM", "LEMBAGA", "CUSTOM"
  lembagaId     String?                 // For LEMBAGA type
  description   String?
  status        String                  @default("ACTIVE") // "ACTIVE", "ARCHIVED"
  createdBy     String
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  
  lembaga       Lembaga?                @relation(fields: [lembagaId], references: [id])
  assignments   BookkeepingAssignment[]
  transactions  Transaction[]
  closedPeriods BookkeepingPeriod[]
  
  @@index([type])
  @@index([lembagaId])
  @@index([status])
}

// Assignment: Pengurus assigned to manage specific bookkeeping
model BookkeepingAssignment {
  id            String      @id @default(cuid())
  bookkeepingId String
  userId        String      // User (Pengurus/Bendahara)
  role          String      // "MANAGER", "VIEWER", "EDITOR"
  assignedAt    DateTime    @default(now())
  assignedBy    String?     // Admin who assigned
  
  bookkeeping   Bookkeeping @relation(fields: [bookkeepingId], references: [id], onDelete: Cascade)
  user          User        @relation(fields: [userId], references: [id])
  
  @@unique([bookkeepingId, userId])
  @@index([userId])
  @@index([bookkeepingId])
}

// Closed periods for bookkeeping
model BookkeepingPeriod {
  id            String      @id @default(cuid())
  bookkeepingId String
  periodStart   DateTime
  periodEnd     DateTime
  closedAt      DateTime    @default(now())
  closedBy      String
  notes         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  
  bookkeeping   Bookkeeping @relation(fields: [bookkeepingId], references: [id], onDelete: Cascade)
  
  @@index([bookkeepingId])
  @@index([periodStart, periodEnd])
}

// User Registration with Admin Approval
model UserRegistration {
  id                String   @id @default(cuid())
  name              String
  username          String   @unique
  email             String?
  phone             String?
  requestedRole     String   // Role yang diminta
  reason            String?  // Alasan pendaftaran
  status            String   @default("PENDING") // "PENDING", "APPROVED", "REJECTED"
  
  // Admin review
  reviewedBy        String?  // User ID admin yang review
  reviewedAt        DateTime?
  reviewNotes       String?  // Catatan dari admin
  
  // Link to created user (after approval)
  userId            String?  @unique
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([status])
}

model GradeSetting {
  id          String   @id @default(cuid())
  lembagaId   String
  gradeValue  Float
  label       String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  lembaga     Lembaga  @relation(fields: [lembagaId], references: [id], onDelete: Cascade)

  @@unique([lembagaId, gradeValue])
  @@index([lembagaId])
}
